<div id="app" v-cloak>
    <h1>Harvest Report</h1>
    <p>This page is a <i>mockup</i> of a simplified harvest report.</p>
  
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" v-model="reportTitle">
  
    <br>
    <br>
  
    <label for="startDate">Start Date:</label>
    <input type="date" id="startDate" name="startDate" v-model="reportStartDate" :max="reportEndDate">
  
    <label for="endDate">End Date:</label>
    <input type="date" id="endDate" name="endDate" v-model="reportEndDate" :min="reportStartDate">
  
  
    <br>
    <br>
  
    <label for="crop">Crop:</label>
    <select id="crop" name="crop" v-model="reportCrop">
      <!-- <option v-for="crop in crops">{{ crop }}</option> -->
      <option v-for="crop in cropNames" :value="crop" :key="crop">{{ crop }}</option>
    </select>
  
    <label for="field">Area:</label>
    <select id="field" name="field">
      <option v-for="field in fields">{{ field }}</option>
    </select>
  
    <br>
    <br>
  
    <button type="submit" @click='addHarvest'>Generate Report</button>
    <hr>
  
    <h1>{{ reportTitle ? reportTitle : "Mock Harvest Report"}}</h1>
    <p>Details:</p>
    <ul>
        <li><strong>Farm:</strong>{{ reportFarm }}</li>
        <li><strong>User:</strong>{{ reportUser }}</li>
        <li><strong>Language:</strong>{{ reportLanguage }}</li>
        <br>
        <li><strong>Start:</strong>{{ reportStartDate }}</li>
        <li><strong>End:</strong>{{ reportEndDate }}</li>
        <li><strong>Crop:</strong>{{ reportCrop }}</li>
    </ul>
    
    <div v-if="harvestList.length > 0">
        <table border="1">
        <thead>
            <tr>
                <th scope="col">Row</th>
                <th scope="col">Date</th>
                <th scope="col">Area</th>
                <th scope="col">Crop</th>
                <th scope="col">Yield</th>
                <th scope="col">Units</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="(item, row) in harvestList">
                <td>{{ row + 1 }}</td>
                <td>{{ item.date }}</td>
                <td>{{ item.area }}</td>
                <td>{{ item.crop }}</td>
                <td>{{ item.yield }}</td>
                <td>{{ item.units }}</td>
        </tr>
        </tbody>
        </table>
  </div>
  <p v-else>There are no matching records!</p>
  
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        reportFarm: "",
        reportUser: "",
        reportLanguage: "",
        reportTitle: 'My Sample Harvest Report',
        reportStartDate: "2020-05-05",
        reportEndDate: "2020-05-15",
        reportCrop: 'Kale',
        crops: ["Broccoli", "Kale", "Peas"],
        fields: ["All", "Chuau-1", "SQ7"],
        harvestList: [],
        idToCropMap: new Map(),
      },
      methods: {
        addHarvest: function() {
          axios.get('/farm.json')
        .then((response) => {
            this.reportFarm = response.data.name;
            this.reportUser = response.data.user.name;
            this.reportLanguage = response.data.languages.en.name;
        })
        .catch((error) => {
            console.log("Error Occurred");
            console.log(error);
        });
            this.harvestList.push({date:"2018-05-01", area:"Orion-3", crop:"Kale", yield:"12", units:"Bunches"});
        }
    },
    created() {
      console.log("HarvestReport Vue instance created!")
      getIDToCropMap()
      .then((theMap) => {
        this.idToCropMap = theMap;
      })
      .catch((err) => {
        console.error("Error fetching ID to Crop Map:", err);
      });
    },
    computed: {
    cropNames: function () {
      return Array.from(this.idToCropMap.values());
    },
  },
    });
    Vue.config.devtools = true;
  </script>
  
    